<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Delivery Fee Portion Calculator!</title>
  </head>
  <body>
    <script>window.$ = window.jQuery = require('./node_modules/jquery/dist/jquery.js');</script>
    <h1>Delivery Fee Portion Calculator!</h1>
    <div id="orderInputContainer">
      <label for="itemOneInput">Item 1 Price:</label>
      <input id="itemOneInput" type="text" placeholder="Enter the price of item 1!" autofocus></input>
    </div>
    <div>
      <label for="orderMainDeliveryFee">Total Misc. Delivery Fees: </label>
      <input id="orderMainDeliveryFee" type="text" placeholder="Enter total misc. delivery fees"></input>
      <label for="orderTaxAndFees">Total Tax And Extra Fees: </label>
      <input id="orderTaxAndFees" type="text" placeholder="Enter taxes and other fees field."></input>
      <label for="orderTip">Total Tip Amount: </label>
      <input id="orderTip" type="text" placeholder="Enter the tip amount."></input>
    </div>
    <button id="inputAdd">Add item input field</button>
    <button id="inputRemove">Remove last item input field</button>
    <button id="mainSubmit">Submit Delivery Values</button>
    <div id="orderResultContainer">
    </div>
    <script>
      const {ipcRenderer} = require('electron');
      let dynamicInputId, inputLabelId;
      let dynamicInputIdStack = [], inputLabelIdStack = [];
      let inputCount = 1;

      $('#mainSubmit').click(function(){
        let itemOnePrice = $('#itemOneInput').val();
        let orderMainDeliveryFee = $('#orderMainDeliveryFee').val();
        let orderTaxAndFees = $('#orderTaxAndFees').val();
        let orderTip = $('#orderTip').val();
        let itemPriceArray = [];

        //We should always have at least one item (due to static input)
        itemPriceArray.push($('#itemOneInput').val());

        for(let i = 2; i <= inputCount; i++){
          itemPriceArray.push($('#' + dynamicInputId).val());
        }

        console.log(itemPriceArray);

        let order = {
          itemPriceArray : itemPriceArray,
          orderMainDeliveryFee: orderMainDeliveryFee,
          orderTaxAndFees: orderTaxAndFees,
          orderTip: orderTip
        };

        let resultPriceArray = ipcRenderer.sendSync('test-delivery', order);
        
        console.log('IPC RETURNED VALUE: ' + resultPriceArray);

        //clear results of previous calculations
        $('#orderResultContainer').empty();

        for(let i=0; i < resultPriceArray.length; i++){
          let resultP = createElement('p', null, 'Price for item ' + (i+1) + ' is: ' + resultPriceArray[i]);
          $('#orderResultContainer').append(resultP);
        }
      });

      window.$('#inputAdd').click(function(){
        inputCount++;
        dynamicInputId = 'dynamicInput' + inputCount;
        inputLabelId = 'inputLabel' + inputCount;

        let inputAttributes = {};
        inputAttributes.id = dynamicInputId;
        inputAttributes.placeholder = 'Enter the price of item ' + inputCount;

        let inputLabelAttributes = {};
        inputLabelAttributes.id = inputLabelId;
        inputLabelAttributes.for = dynamicInputId;
        let inputLabelValue = 'Item ' + inputCount + ' Price: ';

        let input = createElement('input', inputAttributes);
        let inputLabel = createElement('label', inputLabelAttributes, inputLabelValue);

        let divToAdd = $('#orderInputContainer');
        divToAdd.append(inputLabel);
        divToAdd.append(input);

        dynamicInputIdStack.push(dynamicInputId);
        inputLabelIdStack.push(inputLabelId);
      });

      window.$('#inputRemove').click(function(){
        if(inputCount === 1){
          console.log('Cant remove more input fields!');
          return;
        }

        $('#' + dynamicInputIdStack[dynamicInputIdStack.length - 1]).remove();
        $('#' + inputLabelIdStack[inputLabelIdStack.length - 1]).remove();

        inputCount--;
        dynamicInputIdStack.pop();
        inputLabelIdStack.pop();
      });

      //elementType::String of element type
      //attributes::Associative Array of attribute names and values (optional)
      //value::String of value for element (optional)
      function createElement(elementType, attributes = null, value = null){
        let element = $('<' + elementType + '>');

        if(attributes !== null){
          for(attributeName in attributes){
            element.attr(attributeName, attributes[attributeName]);
          }
        }

        if(value !== null){
          console.log('ENTERED OPTIONAL VALUE SCOPE');
          console.log('VALUE: ' + value);
          //element.val(value);
          element.text(value);
        }

        return element;
      }

    </script>
  </body>
</html>