<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Delivery Fee Portion Calculator!</title>
  </head>
  <body>
    <script>window.$ = window.jQuery = require('./node_modules/jquery/dist/jquery.js');</script>
    <h1>Delivery Fee Portion Calculator!</h1>
    <div id="orderInputContainer">
      <label for="itemOneInput">Item 1 Price:</label>
      <input id="itemOneInput" type="text" placeholder="Enter the price of item 1!" autofocus></input>
    </div>
    <div>
      <label for="orderMainDeliveryFee">Total Misc. Delivery Fees: </label>
      <input id="orderMainDeliveryFee" type="text" placeholder="Enter total misc. delivery fees"></input>
      <label for="orderTaxAndFees">Total Tax And Extra Fees: </label>
      <input id="orderTaxAndFees" type="text" placeholder="Enter taxes and other fees field."></input>
      <label for="orderTip">Total Tip Amount: </label>
      <input id="orderTip" type="text" placeholder="Enter the tip amount."></input>
    </div>
    <button id="inputAdd">Add item input field</button>
    <button id="inputRemove">Remove last item input field</button>
    <button id="mainSubmit">Submit Delivery Values</button>
    <div id="orderResultContainer">
    </div>
    <script>
      const {ipcRenderer} = require('electron');
      let dynamicInputId, inputLabelId;
      let inputCount = 1;

      window.$('#mainSubmit').click(function(){
        let itemOnePrice = document.getElementById('itemOneInput').value;
        //let itemTwoPrice = document.getElementById('itemTwoInput').value;
        let orderMainDeliveryFee = document.getElementById('orderMainDeliveryFee').value;
        let orderTaxAndFees = document.getElementById('orderTaxAndFees').value;
        let orderTip = document.getElementById('orderTip').value;
        let itemPriceArray = [];

        itemPriceArray.push(window.$('#itemOneInput').val());

        //TODO: Fix funky index start point 
        for(let i = 2; i <= inputCount; i++){
          let dynamicItemVal = window.$('#dynamicInput' + i).val();
          itemPriceArray.push(dynamicItemVal);
        }

        console.log(itemPriceArray);

        order = {
          itemPriceArray : itemPriceArray,
          orderMainDeliveryFee: orderMainDeliveryFee,
          orderTaxAndFees: orderTaxAndFees,
          orderTip: orderTip
        };

        let resultPriceArray = ipcRenderer.sendSync('test-delivery', order);
        
        console.log('IPC RETURNED VALUE: ' + resultPriceArray);

        for(let i=0; i<resultPriceArray.length; i++){
          console.log('Price for item ' + (i+1) + ' is: ' + resultPriceArray[i]);
          let resultP = window.$('<p>Price for item ' + (i+1) + ' is: ' + resultPriceArray[i] + '</p>');
          window.$('#orderResultContainer').append(resultP);
        }
      });

      window.$('#inputAdd').click(function(){
        //TODO: come-up with consistent way of naming input fields (especially dynamically created input fields)
        ++inputCount;
        let input = window.$('<input>');
        let dynamicInputText = 'Enter the price of item ' + inputCount;
        dynamicInputId = 'dynamicInput' + inputCount;
        inputLabelId = 'inputLabel' + inputCount;

        input.attr('id', dynamicInputId);
        input.attr('placeholder', dynamicInputText);
        console.log(inputCount);

        let divToAdd = window.$('#orderInputContainer');
        let inputLabel = window.$('<label id=' + inputLabelId + ' for=' + dynamicInputId + '>Item ' + inputCount + ' Price: </label>');

        divToAdd.append(inputLabel);
        divToAdd.append(input);

      });

      //TODO: FIX THIS
      window.$('#inputRemove').click(function(){
        if(inputCount == 1){
          console.log('Cant remove more input fields!');
          return;
        }

        console.log('START INPUT COUNT: ' + inputCount);
        window.$('#' + dynamicInputId).remove();
        window.$('#' + inputLabelId).remove();
        inputCount--;
        console.log('END INPUT COUNT: ' + inputCount);
        dynamicInputId = 'dynamicInput' + inputCount;
        inputLabelId = 'dynamicInputId' + inputCount;
      });

    </script>
  </body>
</html>